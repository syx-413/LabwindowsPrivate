#include <ansi_c.h>
#include <utility.h>
#include "comm.h"
#include "datatype.h"
#include "protocol.h"

extern unsigned char checkSum(unsigned char *buf, unsigned int len);
/*--------------------------------------------------------------
	函数功能: 读参数命令	  读取设定的 GetPrDataCB
----------------------------------------------------------------*/
void makeReadPrDataPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_RDPRDATA&0xFF;
	buf[i++] = TX_RDPRDATA>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能：写参数命令	参数下发
--------------------------------------------------------------*/
void makeWritePrDataPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	u16 j;
	u8 *pdat = (u8*)&prdata;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = sizeof(prdata)&0xFF;
	buf[i++] = sizeof(prdata)>>8;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_WRPRDATA&0xFF;
	buf[i++] = TX_WRPRDATA>>8;
	//-----------------数据-------------------
	for(j=0; j<sizeof(prdata); j++)
	{
		buf[i++] = pdat[j];
	}
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 读校准数据	GetCrCB Bitton
--------------------------------------------------------------*/
void makeReadCrDataPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_RDCRDATA&0xFF;
	buf[i++] = TX_RDCRDATA>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能：写校准数据
--------------------------------------------------------------*/
void makeWriteCrDataPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	u16 j;
	u8 *pdat = (u8*)&crdata;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = sizeof(crdata)&0xFF;
	buf[i++] = sizeof(crdata)>>8;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_WRCRDATA&0xFF;
	buf[i++] = TX_WRCRDATA>>8;
	//-----------------数据-------------------
	for(j=0; j<sizeof(crdata); j++)
	{
		buf[i++] = pdat[j];
	}
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 清故障执行命令
--------------------------------------------------------------*/
void makeClrfDonePacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_CLRDONE&0xFF;
	buf[i++] = TX_CLRDONE>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 清故障撤销命令
--------------------------------------------------------------*/
void makeClrfCanselPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_CLRCANSEL&0xFF;
	buf[i++] = TX_CLRCANSEL>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 投预充电电阻命令
--------------------------------------------------------------*/
void makeSRONPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_SRON&0xFF;
	buf[i++] = TX_SRON>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 切预充电电阻命令
--------------------------------------------------------------*/
void makeSROFFPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_SROFF&0xFF;
	buf[i++] = TX_SROFF>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 投主开关命令
--------------------------------------------------------------*/
void makeSMONPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_SMON&0xFF;
	buf[i++] = TX_SMON>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 切主开关命令
--------------------------------------------------------------*/
void makeSMOFFPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_SMOFF&0xFF;
	buf[i++] = TX_SMOFF>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 开始工作命令
--------------------------------------------------------------*/
void makeWorkDonePacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_WORKDONE&0xFF;
	buf[i++] = TX_WORKDONE>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 取消工作命令
--------------------------------------------------------------*/
void makeWorkCanselPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_WORKCANSEL&0xFF;
	buf[i++] = TX_WORKCANSEL>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 急停有效命令
--------------------------------------------------------------*/
void makeEMRDonePacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_EMRDONE&0xFF;
	buf[i++] = TX_EMRDONE>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 急停撤销命令
--------------------------------------------------------------*/
void makeEMRCanselPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_EMRCANSEL&0xFF;
	buf[i++] = TX_EMRCANSEL>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 清除事件记录命令
--------------------------------------------------------------*/
void makeClearEventPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_CLREVENT&0xFF;
	buf[i++] = TX_CLREVENT>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 读事件记录命令
--------------------------------------------------------------*/
extern unsigned int  evtIndex;
void makeReadEventPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_READEVENT&0xFF;
	buf[i++] = TX_READEVENT>>8;
	//-----------------数据-------------------
	buf[i++] = evtIndex;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 对时命令
--------------------------------------------------------------*/
void makeCheckTimePacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;

	int year, mon, day, hour, min, sec;

	GetSystemDate(&mon, &day, &year);
	GetSystemTime(&hour, &min, &sec);

	year -= 2000;
	i = year/10*16 + year%10;
	year = i;

	i = mon/10*16 + mon%10;
	mon = i;

	i = day/10*16 + day%10;
	day = i;

	i = hour/10*16 + hour%10;
	hour = i;

	i = min/10*16 + min%10;
	min = i;

	i = sec/10*16 + sec%10;
	sec = i;

	i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x06;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_CHECKTIME&0xFF;
	buf[i++] = TX_CHECKTIME>>8;
	//-----------------数据-------------------
	buf[i++] = year;
	buf[i++] = mon;
	buf[i++] = day;
	buf[i++] = hour;
	buf[i++] = min;
	buf[i++] = sec;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 选择系统电流采样
--------------------------------------------------------------*/
void makeSELCTSYSPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xff00)>>8;
	buf[i++] = id&0xff;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_SELCTSYS&0xFF;
	buf[i++] = TX_SELCTSYS>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 选择负载电流采样
--------------------------------------------------------------*/
void makeSELCTLOADPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xff00)>>8;
	buf[i++] = id&0xff;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_SELCTLOAD&0xFF;
	buf[i++] = TX_SELCTLOAD>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 选择系统电流采样
--------------------------------------------------------------*/
void makeQF3ONPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_QF3ON&0xFF;
	buf[i++] = TX_QF3ON>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 选择负载电流采样
--------------------------------------------------------------*/
void makeQF3OFFPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_QF3OFF&0xFF;
	buf[i++] = TX_QF3OFF>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 自动运行
--------------------------------------------------------------*/
void makeAutoStartPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_AUTOSTART&0xFF;
	buf[i++] = TX_AUTOSTART>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 自动停机
--------------------------------------------------------------*/
void makeAutoStopPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_AUTOSTOP&0xFF;
	buf[i++] = TX_AUTOSTOP>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能：读参考数据
--------------------------------------------------------------*/
void makeReadRefPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_READREF&0xFF;
	buf[i++] = TX_READREF>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*-------------------------------------------------------------
	函数功能: 写参考数据
---------------------------------------------------------------*/
void makeWriteRefPacket(u16 id, u8 *buf, u16 *slen)
{
	int i = 0;
	u16 j;
	u8 *pdat = (u8*)&elTstVal;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = sizeof(elTstVal)&0xFF;
	buf[i++] = sizeof(elTstVal)>>8;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_WRITEREF&0xFF;
	buf[i++] = TX_WRITEREF>>8;
	//-----------------数据-------------------
	for(j=0; j<sizeof(elTstVal); j++)
	{
		buf[i++] = pdat[j];
	}
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: 发送心跳数据
--------------------------------------------------------------*/
void makeHBPacket(u16 id, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = TX_HB&0xFF;
	buf[i++] = TX_HB>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*------------------------------------------------------------
	函数功能: STS开关控制
--------------------------------------------------------------*/
void makeSTSPacket(u16 id, u16 cw, u8 *buf, u16 *slen)
{
	u16 i = 0;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------地址-------------------
	buf[i++] = (id&0xFF00)>>8;
	buf[i++] = id&0xFF;
	//-----------------数据长度---------------
	buf[i++] = 0x02;
	buf[i++] = 0x00;
	//-----------------数据包头---------------
	buf[i++] = 0x68;
	//-----------------功能码-----------------
	buf[i++] = cw&0xFF;
	buf[i++] = cw>>8;
	//-----------------数据-------------------
	buf[i++] = 0x5A;
	buf[i++] = 0x5A;
	//-----------------校验码-----------------
	buf[i] = checkSum(&buf[8], i-8);
	i++;
	//-----------------结束码-----------------
	buf[i++] = 0x16;
	*slen = i;
}
/*发送数据*/
void rtDataMaker(u8 *sbuf, u16 *slen)
{
	s16 index = 0;
	s16 i;
	s16 len;
	u8 *p;
	s16 s;
	p = (uint8_t*)&irt_data;
	len = sizeof(irt_data);
//-----------------数据包头---------------
	sbuf[index++] = 0x68;
	//-----------------地址-------------------
	sbuf[index++] = 0x00;
	sbuf[index++] = 0x01;
	//-----------------数据长度---------------
	sbuf[index++] = len&0xFF;
	sbuf[index++] = len >> 8;
	//-----------------数据包头---------------
	sbuf[index++] = 0x68;
	//-----------------功能码-----------------
	sbuf[index++] = 0x80;
	sbuf[index++] = 0x00;
	//-----------------数据-------------------
	for(i = 0; i < len; i++)
	{
		sbuf[index++] = p[i];
	}
	//-----------------校验码-----------------
	sbuf[index] = checkSum(&sbuf[8], index - 8);
	index++;
	sbuf[index++] = 0x16;
	*slen = index;
	/*
	printf("S Data Buffer (sbuf): ");
    for (int k = 0; k < *slen; k++) {
        printf("%02X ", sbuf[k]);
    }
    printf("\n");
    printf("Generated Data Length (slen): %u\n", *slen); 
	*/
}
/*主动获取数据*/    
void rtDataGet(u8 *sbuf, u16 *slen)
{
	s16 index = 0;
	s16 i=0;
	s16 len;
	len = sizeof(irt_data);
	//-----------------数据包头---------------
	sbuf[index++] = 0x68;
	//-----------------地址-------------------
	sbuf[index++] = 0x00;
	sbuf[index++] = 0x01;
	//-----------------数据长度---------------
	sbuf[index++] = len&0xFF;
	sbuf[index++] = len >> 8;
	//-----------------数据包头---------------
	sbuf[index++] = 0x68;
	//-----------------功能码-----------------
	sbuf[index++] = 0x80;
	sbuf[index++] = 0x00;
	//-----------------数据-------------------
	sbuf[index++] = 0x5A;
	sbuf[index++] = 0x5A;
	//-----------------校验码-----------------
	sbuf[index] = checkSum(&sbuf[8], index - 8);
	index++;
	//-----------------结束码-----------------
	sbuf[index++] = 0x16;
	*slen = index;
/*	
	printf("R Data Buffer (sbuf): \n");
	for (i = 0; i < *slen; i++)
	{
		printf("%02X ", sbuf[i]);
	}
    printf("\n");
    printf("R Data Length (slen): %u\n", *slen); 
	*/
}
